# LIDAR IPU

The LIDAR Input Processing Unit (IPU) receives LIDAR data from a source (`src/ipu/source/lidar.py`) and translates it to neuronal activity (`src/ipu/processor/proximity.py`) in the artificial brain. Data can be sourced from physical or virtual environments. Code in `src/ros` supports FEAGI integration with a virtual [turtlebot3](https://emanual.robotis.com/docs/en/platform/turtlebot3/overview/) in a [Gazebo](http://gazebosim.org/) simulation environment. In this simulation, FEAGI processes the LIDAR data as it is generated by the robot's sensors while navigating obstacles in the virtual environment.

## **Setup**

The turtlebot3 simulation depends on [ROS](https://www.ros.org/) (Robot Operating System) and Gazebo simulation software, which must be installed prior to running.

### **Install ROS (Foxy)**
___

Install some Linux system tools (if necessary):
* `$ sudo apt update && sudo apt install curl gnupg2 lsb-release`

Import the ROS public GPG key (this operation should respond with 'OK'):
* `$ curl -s https://raw.githubusercontent.com/ros/rosdistro/master/ros.asc | sudo apt-key add -`

Add the ROS repository to sources list:
* `$ sudo sh -c 'echo "deb [arch=$(dpkg --print-architecture)] http://packages.ros.org/ros2/ubuntu $(lsb_release -cs) main" > /etc/apt/sources.list.d/ros2-latest.list'`

Install ROS Foxy (desktop version):
* `$ sudo apt install ros-foxy-desktop`

Source ROS:
* `$ source /opt/ros/foxy/setup.bash`

Add the previous command to .bashrc to avoid needing to source ROS in every new terminal instance:
* `$ echo "source /opt/ros/foxy/setup.bash" >> ~/.bashrc`

### **Install colcon build tool**
___

This tool is needed for building turtlebot3 repositories:
* `$ sudo apt install python3-colcon-common-extensions`

### **Install Gazebo**
___
* `$ sudo apt install gazebo11 ros-foxy-gazebo-ros-pkgs`

### **Install turtlebot3 repositories**
___

Install a tool for enabling batch commands on VCS repositories:
* `$ sudo apt install python3-vcstool`

Create and navigate to a turtlebot3 workspace:
* `$ mkdir -p ~/turtlebot3_ws/src`
* `$ cd ~/turtlebot3_ws`

Download and build the turtlebot3 repositories:
* `$ wget https://raw.githubusercontent.com/ROBOTIS-GIT/turtlebot3/ros2/turtlebot3.repos`
* `$ vcs import src < turtlebot3.repos`
* `$ colcon build --symlink-install`

### **Update post-install environment**
___
* `$ echo 'source ~/turtlebot3_ws/install/setup.bash' >> ~/.bashrc`
* `$ echo 'export GAZEBO_MODEL_PATH=$GAZEBO_MODEL_PATH:~/turtlebot3_ws/src/turtlebot3/turtlebot3_simulations/turtlebot3_gazebo/models' >> ~/.bashrc`
* `$ echo 'export TURTLEBOT3_MODEL=waffle_pi' >> ~/.bashrc`
* `$ source ~/.bashrc`

### **Activate FEAGI <==> ROS interface**
___

In a terminal, create a ROS workspace by navigating to `feagi-core/src/ros` and running:
* `$ ./ws_setup.sh`

### **Update FEAGI configuration file**
___

Configure FEAGI to listen for streaming LIDAR data by editing `feagi-core/src/feagi_configuration.ini`. Under the `[IPU]` heading in the configuration file, ensure that the `proximity` parameter is set to `True`.

## **Execution**
If the commands in the preceding sections completed successfully, test that LIDAR data is flowing from the turtlebot3 in the virtual environment to FEAGI. Confirm that the contents of FEAGI's fire candidate list (visible in FEAGI output during bursting phase) is changing (i.e. different neurons within the proximity cortical area are being activated) as the turtlebot3 moves around its environment.

In a _**new**_ terminal, initialize the Gazebo environment and turtlebot3:
* `$ ros2 launch turtlebot3_gazebo turtlebot3_world.launch.py`

In another _**new**_ terminal, start the ROS laser scan topic:
* `$ ros2 run py_topic py_laser_scan`

In yet another _**new**_ terminal, activate manual, keyboard-based control of the turtlebot3:
* `$ ros2 run turtlebot3_teleop teleop_keyboard`

Now that the turtlebot3 is active and generating LIDAR data in the virtual environment, start FEAGI to complete the interface by navigating to `feagi-core/src` in a separate terminal and running:
* `$ python3 main.py`